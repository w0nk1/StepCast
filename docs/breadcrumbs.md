2026-02-02
- Read AGENTS.md; research: macOS screen recording + accessibility permissions; tauri-plugin-macos-permissions; PDF export gap in Wry; Exa websearch failing (400).
- Reviewed robinebers/openusage Tauri 2 app: tray/panel (tauri-nspanel), QuickJS plugin engine, capabilities, tauri config.
- User chose menu bar panel UI.
- Initialized git repo and created GitHub repo w0nk1/StepCast (main).
- Set repo visibility to private (w0nk1/StepCast).
- Wrote design doc and implementation plan in docs/plans.
- Task 1: scaffolded Tauri 2 React+TS (bun), added recorder test harness, ran cargo test fail then pass; restored docs after scaffold overwrite.
- Task 1 fix: restored .worktrees ignore; re-ran recorder harness failing then passing test.
- Task 1: code quality review of scaffold + recorder harness + .gitignore.
- Plan/spec: recorder test rename + test-only module gate.
- Code quality review: wired recorder in run() to avoid dead_code warning.
- Task 2: added minimal spec; implementing recorder data model + JSON roundtrip test (TDD).
- Task 3: added recorder state machine spec; implementing state machine + tests (TDD).
- Spec: Task 4 macOS screencapture backend: CaptureBackend trait; build_args uses -x -R with region and output; screencapture CLI.

2026-02-03
- Task 4: add CaptureError, validation, and stderr handling for macOS screencapture backend.
- Research: Exa code/web search attempts failed (400).
- Task 5: wrote storage spec; adding recorder storage module + test (TDD).
- Task 5: define StorageError and update write_steps result type.
- Task 6: added PermissionStatus test (fail: missing type), wired macos-permissions plugin, app state, commands, and capability permission; test pass.
- Task 7: Exa code/web search failed (400); fetched tauri-nspanel docs via gh; added panel/tray wiring with non-activating panel, tray click toggle, and panel positioning; TDD panel label test fail then pass.
- Task 8: ran export render tests; manual verification step (bun tauri dev) deferred due to non-interactive environment.
- Task 6: make start_recording async with permission checks; remove unused recorder init.
- Task 7: enforce permissions on resume_recording.
- Task 7: research attempts failed (Exa code/web search 400); pulled OpenUsage panel/tray patterns via GitHub raw.
- Task 7: added tauri-nspanel panel/tray modules, tray toggle positioning, and macOS private API window config.
- Task 7: created code quality fix plan; Exa code search failed (400).
- Task 7: Exa web search failed (400); applied tray icon fallback, pre-show positioning, and monitor fallback handling.
- Task 7: created panel code quality fixes plan (remove monitor helper, propagate panel.hide).
- Task 7: removed resolve_monitor and propagated panel.hide error.
- Task 7: reintroduced monitor work-area helper, clamped panel position to monitor bounds, and aligned panel size to tauri.conf.json.
- Task 8: wrote export render spec + plan; adding HTML/Markdown templates and render functions with TDD.
- Task 8: add HTML escaping for renderHtml and tests for renderMarkdown + escaping.
- Spec: renderMarkdown escapes HTML entities for title; add test for < > &.
- Task 9/10: replaced UI with RecorderPanel, added export/print flow styling, wrote README and MIT license.
- Task 7 fix: panel init now converts existing main window to panel, avoiding duplicate "panel" label; added helper test and updated label.
- Dev run: bun tauri dev started; process terminated due to CLI timeout (app still running in interactive mode).
- Task 7 fix: enable left-click tray toggle and allow dragging panel by background.
- UI fix: increased panel height to 640 to keep Export visible without scrolling.
- UI tweak: increased panel height to 720 after still seeing scroll.
- UX: tray click now orders panel front regardless for reliable focus.
- Permissions: request_permissions now opens macOS Privacy panes for Screen Recording/Accessibility when missing.
- Fix: tray toggle listens on MouseButtonState::Up to avoid double events and ensure show/hide.
- Fix: panel allows key window and uses show_and_make_key on tray click to ensure visibility.
- Debug: compared OpenUsage panel/tray implementation; aligned panel level, style mask, collection behavior, and show-before-position behavior.

2026-02-08
- PDF optimization: adding PDFKit post-processing (Approach B) on top of existing JPEG data URIs (Approach A). Helper `optimize_pdf_bytes` in pdf.rs applies saveAllImagesAsJPEG + optimizeImagesForScreen via objc2-pdf-kit, best-effort fallback to original bytes.
- Bug: WhatsApp GIF picker screenshot shows main chat instead of picker overlay.
- Root cause: `get_topmost_window_at_point` returns the Dock's full-screen overlay (layer=20, 2560x1080) as topmost for ALL clicks. Pipeline correctly rejects it as system UI, but falls back to the main window — never sees the GIF picker underneath.
- Fix 1: skip system UI windows inside `get_topmost_window_at_point` (window_info.rs) so the next real app window (e.g. GIF picker) is returned.
- Fix 2: track `capture_from_topmost` flag in pipeline.rs; when true, don't replace overlay with main window in reconciliation block (defense-in-depth).
- Smoothness review: audited full codebase (22 Rust files, 18 frontend files, CI, docs). Report at docs/plans/2026-02-08-smoothness-review.md.
- Key findings: mixed pkg manager (npm+bun), unpinned git deps, pipeline.rs 2203 LOC / window_info.rs 1437 LOC exceed 400-LOC guideline, 6+ stale plans in docs/.
- Frontend: zero console.*, zero TODOs, zero any types, 100% component test coverage — excellent shape.
- Rust: zero production panics, all eprintln guarded by debug_assertions, proper Result types throughout — solid.
- Produced 9-item prioritized backlog (B1-B9) with effort estimates.
- Startup UX: wrote spec (docs/specs/2026-02-08-startup-ux.md), created startup_state.rs module with load/save + 4 unit tests.
- Startup UX: gating auto-show behind has_launched_before; adding global shortcut (Cmd+Shift+S), tray menu items, tutorial banner.
- Startup UX: removed auto-show entirely per plan; implemented Dock icon hint via ActivationPolicy::Regular on first run.
- Startup UX: regenerated icon assets with full-bleed gradient (no transparent corners) for proper macOS squircle mask.
- Release notes: added last_seen_version to startup_state, update prompt now shows body text, What's New banner after version change.
- Export WebP: added to_webp_or_png() + load_screenshot_optimized() helpers; HTML export uses dynamic MIME; Markdown export converts + writes correct extension.
- Export WebP: removed unused load_screenshot_base64; all 142 Rust + 75 frontend tests pass; clippy clean.
- PDF compression research: WKWebView.createPDF() has zero compression controls; WebP not in PDF spec (re-encoded to lossless = bloat); PDFKit macOS 13+ has saveAllImagesAsJPEG + optimizeImagesForScreen write options; Quartz filters work but need raw FFI; best approach = JPEG data URIs for PDF export + optional PDFKit post-processing. Spec at docs/specs/pdf-compression.md.
